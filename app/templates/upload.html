<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SmartBite - Upload Recipe</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/upload.css') }}" />
</head>

<body>
  <!-- Header -->
  {% include 'header.html' %}


  <!-- Main Content -->
  <div class="main-content">
    <div class="main-container">
      <!-- Sidebar -->
      {% include 'side.html' %}

      <!-- Upload Form Section -->
      <div class="main-inner">
        <div class="upload-form-container">
          <h1 class="intro-title mb-3">Upload Your Recipe</h1>

          <form method="POST" action="{{ url_for('main.handle_upload') }}" enctype="multipart/form-data">
            <!-- Dish Name -->
            <div class="form-group mb-3">
              <label>Dish Name</label>
              <input type="text" name="title" class="form-control" required />
            </div>

            <!-- Ingredients -->
            <div id="ingredients-list">
              <div class="ingredient-row d-flex gap-2 mb-2">
                <select name="ingredient_type[]" class="form-select" style="width: 15%;">
                  <option value="meat">Meat</option>
                  <option value="vegetable">Vegetable</option>
                </select>
                <input type="text" name="ingredient_name[]" placeholder="Ingredient Name" class="form-control" required />
                <select name="ingredient_grams[]" class="form-select" style="width: 20%;" onchange="toggleCustomInput(this)">
                  <option value="50">50g</option>
                  <option value="100">100g</option>
                  <option value="150">150g</option>
                  <option value="custom">Other...</option>
                </select>
                <input type="number" name="ingredient_grams_custom[]" placeholder="Custom g" class="form-control custom-gram" style="display:none;" />
              </div>
            </div>

            <button type="button" class="btn-outline mb-3" onclick="addIngredient()">+ Add Ingredient</button>

            <!-- Preparation Steps -->
            <div class="form-group mb-3">
              <label>Preparation Steps</label>
              <textarea name="steps" class="form-control" rows="4"></textarea>
            </div>

            <!-- Servings -->
            <div class="form-group mb-3">
              <label>Servings</label>
              <input type="number" name="servings" class="form-control" min="1" />
            </div>

            <!-- Date -->
            <div class="form-group mb-3">
              <label>Date</label>
              <input type="date" name="date" class="form-control" id="recipe-date" required />
            </div>

            <!-- Image Upload (optional) -->
            <!-- <div class="form-group mb-3">
              <label>Dish Image (optional)</label>
              <input type="file" name="image" class="form-control-file" />
            </div> -->

            <button type="submit" class="btn-orange mt-2">Submit Recipe</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  {% include 'footer.html' %}

  <!-- JS -->
  <script>
    // Set the default date to today
    document.addEventListener("DOMContentLoaded", function () {
      const dateInput = document.getElementById("recipe-date");
      const today = new Date().toISOString().split("T")[0]; // Get today's date in YYYY-MM-DD format
      dateInput.value = today; // Set the default value
    });

    function addIngredient() {
      const container = document.getElementById("ingredients-list");
      const row = document.createElement("div");
      row.className = "ingredient-row d-flex gap-2 mb-2";
      row.innerHTML = `
        <select name="ingredient_type[]" class="form-select" style="width: 15%;">
          <option value="meat">Meat</option>
          <option value="vegetable">Vegetable</option>
        </select>
        <input type="text" name="ingredient_name[]" placeholder="Ingredient Name" class="form-control" required />
        <select name="ingredient_grams[]" class="form-select" style="width: 20%;" onchange="toggleCustomInput(this)">
          <option value="50">50g</option>
          <option value="100">100g</option>
          <option value="150">150g</option>
          <option value="custom">Other...</option>
        </select>
        <input type="number" name="ingredient_grams_custom[]" placeholder="Custom g" class="form-control custom-gram" style="display:none;" />
      `;
      container.appendChild(row);
    }

    function toggleCustomInput(selectEl) {
      const customInput = selectEl.nextElementSibling;
      customInput.style.display = selectEl.value === "custom" ? "block" : "none";
    }

    document.querySelector('form').addEventListener('submit', function (event) {
      event.preventDefault(); // Prevent the default form submission

      const form = event.target;
      const formData = new FormData(form);

      fetch(form.action, {
        method: form.method,
        body: formData,
      })
        .then((response) => {
          if (response.ok) {
            alert('Recipe submitted successfully!'); // Show success alert
            window.location.reload(); // Refresh the page
          } else {
            return response.json().then((data) => {
              alert(`Error: ${data.error || 'Something went wrong!'}`); // Show error alert
            });
          }
        })
        .catch((error) => {
          alert(`Error: ${error.message}`); // Show error alert for network issues
        });
    });
  </script>
</body>
</html>
